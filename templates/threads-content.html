{% for thread in threads %}
<article class="thread"{% if let Some(url) = thread.url_for_original_path()? %} data-original-path="{{ url }}"{% endif %}>
{% if !thread.meta.references.is_empty() %}
<header>
    <div class="meta">
        {% if let Some(author) = thread.meta.author %}<span itemprop="author"><a href="{{ author.href }}">{{ author.display_name }}</a> (<a href="{{ author.href }}" class="handle">{{ author.display_handle }}</a>)</span>{% endif %}
        <span class="gap">{% if thread.meta.author.is_some() && thread.meta.published.is_some() %}—{% endif %}</span>
        <span>
        {% if let Some(archived) = thread.meta.archived %}<a class="archived" href="{{ archived }}">[archived]</a>{% endif %}
        <a class="time" href="{% if let Some(url) = thread.url_for_html_permalink()? %}{{ url }}{% endif %}">
        {% if let Some(published) = thread.meta.published %}<time datetime="{{ published }}">{{ published }}</time>{% endif %}
        </a>
        </span>
    </div>
</header>
{% endif %}
{% for post in thread.posts %}
<article class="post cohost">
    <header>
        <div class="meta">
            {% if let Some(author) = post.meta.author %}<span itemprop="author"><a href="{{ author.href }}">{{ author.display_name }}</a> (<a href="{{ author.href }}" class="handle">{{ author.display_handle }}</a>)</span>{% endif %}
            <span class="gap">{% if post.meta.author.is_some() && post.meta.published.is_some() %}—{% endif %}</span>
            <span>
            {% if let Some(archived) = post.meta.archived %}<a class="archived" href="{{ archived }}">[archived]</a>{% endif %}
            {% if thread.meta.references.is_empty() %}<a class="time" href="{% if let Some(url) = thread.url_for_html_permalink()? %}{{ url }}{% endif %}">{% endif %}
            {% if let Some(published) = post.meta.published %}<time datetime="{{ published }}">{{ published }}</time>{% endif %}
            {% if thread.meta.references.is_empty() %}</a>{% endif %}
            </span>
        </div>
        <h1>
            {% if thread.meta.references.is_empty() %}<a href="{% if let Some(url) = thread.url_for_html_permalink()? %}{{ url }}{% endif %}">{% endif %}
            {% if let Some(title) = post.meta.title %}{{ title }}{% endif %}
            {% if thread.meta.references.is_empty() %}</a>{% endif %}
        </h1>
    </header>
    {% if !post.meta.is_transparent_share %}
    <div class="content">{{ post.safe_html|safe }}</div>
    {% endif %}
    <footer><div class="tags">{% for tag in post.meta.tags %}
        {#- TODO: build tag page href properly in path module -#}
        {%- if SETTINGS.tag_is_interesting(tag) -%}<a class="tag" href="tagged/{{ tag }}.html">{%- endif -%}
        <span class="tag">#{{ tag }}</span>
        {%- if SETTINGS.tag_is_interesting(tag) -%}</a>{%- endif -%}
        &#x2003;
    {% endfor %}</div><div class="actions"></div></footer>
</article>
{% endfor %}
</article>
{% endfor %}
